<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"
      integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
    />
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/toastify-js"
    ></script>

    <title>
      Food Diary || Your Ultimate Meal Tracking Companion || Developed by Istiak
      Rahman
    </title>
  </head>
  <body class="relative">
    <!-- component -->
    <script
      src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js"
      defer
    ></script>

    <div class="antialiased bg-gray-100 dark-mode:bg-gray-900">
      <div id="navbar"></div>
    </div>
    <!-- Navbar  -->
    <!-- <nav class="flex justify-between">
      <img
        class="h-[8rem] w-[10rem] animate-bounce invert-1"
        src="/assets/logo.png"
        alt="Logo Here"
        id="logo"
      />
      <div class="flex space-x-4">
        <button
          class="px-3 py-1 h-10 mt-1 text-sm font-medium text-gray-900 bg-white border border-gray-300 rounded-lg shadow-md hover:bg-gray-100 transition-colors duration-300 ease-in-out transform hover:scale-105 dark:text-gray-100 dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-700"
        >
          Overview
        </button>
        <button
          class="px-3 py-1 h-10 mt-1 text-sm font-medium text-gray-900 bg-white border border-gray-300 rounded-lg shadow-md hover:bg-gray-100 transition-colors duration-300 ease-in-out transform hover:scale-105 dark:text-gray-100 dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-700"
        >
          Market
        </button>
        <button
          class="px-3 py-1 h-10 mt-1 text-sm font-medium text-gray-900 bg-white border border-gray-300 rounded-lg shadow-md hover:bg-gray-100 transition-colors duration-300 ease-in-out transform hover:scale-105 dark:text-gray-100 dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-700"
          id="resetButton"
        >
          Reset
        </button>
      </div>

      <div class="icon w-10 m-2">
        <img
          src="assets/dark.png"
          alt="Dark Mode"
          class="cursor-pointer"
          id="mode"
        />
      </div>
    </nav> -->
    <!-- Main section  -->
    <section
      class="main p-2 bg-white w-[80%] sm:w-[50%] mx-auto rounded-md shadow-md"
    >
      <!-- New user created section  -->
      <div class="new-person sm:w-[70%] w-[80%] mx-auto flex justify-center">
        <span
          class="newBtn bg-violet-500 text-white w-fit text-3xl p-[2px] rounded-md m-2 cursor-pointer hover:bg-violet-600 duration-100"
          >New</span
        >

        <div
          class="user-details flex-col w-full sm:w-[80%] justify-between bg-gray-100 p-2 hidden"
        >
          <span class="text-xl text-center py-2">New User</span>
          <input
            class="name p-2 rounded w-full"
            placeholder="Enter Name..."
            type="text"
          />
          <input
            type="number"
            placeholder="Number of meals"
            class="number my-2 p-2 rounded w-full"
          />
          <div class="btns flex justify-between">
            <button
              class="okBtn bg-white text-xl cursor-pointer w-1/3 rounded-md h-8 hover:bg-gray-100 duration-200 mb-2"
            >
              OK
            </button>
            <button
              class="cancelBtn bg-white text-xl cursor-pointer w-1/3 rounded-md h-8 hover:bg-gray-100 duration-200"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
      <!-- User management section  -->
      <div id="pdf-section" class="manage p-2 my-2 h-auto">
        <div
          class="dates flex w-full justify-between text-[12px] sm:text-[15px]"
        >
          <!-- Initial meal date  -->
          <div class="init w-1/2">
            <label
              for="initialMealDate"
              class="block text-sm font-medium text-gray-700"
              >Initial Meal Date:</label
            >
            <input
              id="initialMealDate"
              type="date"
              class="mt-1 block p-2 border rounded-md"
            />
          </div>
          <div class="current">
            <label
              for="currentDate"
              class="block text-sm font-medium text-gray-700"
              >Current Date:</label
            >
            <input
              id="currentDate"
              type="date"
              class="mt-1 block p-2 border rounded-md border-none focus:outline-none focus:border-none"
              readonly
            />
          </div>
        </div>
        <h2 class="mainBoxHeading text-center text-2xl font-bold my-4">
          Total Users List of Meals
        </h2>
        <div
          class="status w-[50%] mx-auto justify-center flex-col items-center hidden"
        >
          <h1 class="font-bold text-2xl">Empty list</h1>
          <p class="text-sm">Add a new user</p>
        </div>
        <ul class="allUsers">
          <!-- Sample list of a user  -->
          <li class="justify-evenly bg-white my-2 rounded-md hidden">
            <span class="name w-[60%] text-xl flex items-center">Fahim</span>
            <span class="justify-center flex w-[20%]"
              ><input type="number" class="mealNumber w-full p-2 border-2"
            /></span>
          </li>
        </ul>
      </div>
    </section>
    <!-- Share Button  -->
    <button
      id="shareButton"
      class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600 duration-200 fixed bottom-4 right-4 z-50"
    >
      Share
    </button>
    <!-- Share Modal  -->
    <!-- Share Modal  -->
    <div
      id="shareModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
    >
      <div class="bg-white p-6 rounded-lg w-[90%] sm:w-[400px]">
        <h2 class="text-xl font-bold mb-4">Share this link</h2>
        <p id="shareLink" class="text-gray-700 mb-4">
          Link will appear here...
        </p>
        <button
          id="copyButton"
          class="bg-green-500 text-white p-2 rounded hover:bg-green-600"
        >
          Copy
        </button>
        <button
          id="closeModal"
          class="bg-gray-300 p-2 rounded hover:bg-gray-400 ml-2"
        >
          Close
        </button>
      </div>
    </div>

    <!-- Alert box  -->
    <div
      class="alert bg-yellow-300 w-[46%] sm:w-[20%] absolute p-2 rounded bottom-[82%] md:w-[16%] md:left-[80%] sm:bottom-[66%] left-[40%] hidden"
    >
      <h1 class="text-red-600 text-lg font-bold">Alert</h1>
      <p class="alertText"></p>
    </div>
    <!-- Footer section  -->
    <footer>
      <p class="text-center text-sm m-2">
        Developed by <b>Istiak Rahman</b> | &copy;
        <script>
          document.write(new Date().getFullYear());
        </script>
      </p>
    </footer>

    <script type="module">
      import { loadNavbar } from "../scripts/functions.js";
      loadNavbar();
      // JavaScript for handling the share button and modal
      document.addEventListener("DOMContentLoaded", () => {
        const shareButton = document.getElementById("shareButton");
        const shareModal = document.getElementById("shareModal");
        const closeModal = document.getElementById("closeModal");
        const shareLink = document.getElementById("shareLink");
        let shareUrl;
        fetch("/api/get-username")
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((data) => {
            shareUrl = `${window.location.href}share/${data.username}`;
          })
          .catch((error) => {
            console.error("Fetch error:", error);
          });

        // Function to open the modal
        const openModal = () => {
          shareModal.classList.remove("hidden");
          localStorage.getItem("username");
          // Set the share link dynamically
          shareLink.textContent = shareUrl;
        };

        // Function to close the modal
        const closeModalFunction = () => {
          shareModal.classList.add("hidden");
        };
        const copyLink = () => {
          console.log(shareUrl);
          navigator.clipboard.writeText(shareUrl).then(
            () => {
              Toastify({
                text: "Link copied to clipboard!",
                duration: 3000,
                gravity: "bottom",
                position: "right",
                backgroundColor: "green",
              }).showToast();
            },
            (err) => {
              console.error("Failed to copy the link: ", err);
            }
          );
        };
        // Event listeners
        shareButton.addEventListener("click", openModal);
        closeModal.addEventListener("click", closeModalFunction);
        copyButton.addEventListener("click", copyLink);
        // Optional: Close the modal when clicking outside of it
        window.addEventListener("click", (event) => {
          if (event.target === shareModal) {
            closeModalFunction();
          }
        });
      });
    </script>
    <script type="module" src="../scripts/index.js"></script>
  </body>
</html>
